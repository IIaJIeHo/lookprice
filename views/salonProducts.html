
    <div class="alert alert-success" id="a-respond-new" style="position:fixed;bottom:0;right:0;display:none;">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong>Поздравляем! </strong>
        Вы добавили новую заявку!
    </div>
<div ng-controller="productCtrl" class="partial-view">
    <div id="loader-wrapper" ng-if="loading">
        <div id="loader"></div>
    </div>
    <div class="header-for mobile-request-hide" ng-show="allitems">
        <div class="pull-left">
            <p><span class="sprite sprite-zayavka"></span>Заявки</p>
        </div>
        <div class="pull-right">
            <div class="input-group search-form input-group-xs">
              <input type="text" class="form-control" ng-model="query" placeholder="Поиск заявки">
              <div class="input-group-addon"><i class="fa fa-search"></i></div>
            </div>
        </div>
    </div>
    <table id="productTable" style="width:100%;" class="table table-lookprice table-bordered table-hover mobile-request-hide" ng-show="allitems" ng-init="check_complete = false; listProducts();">
        <tr class="sort-names">
            <th nowrap><a href="" ng-click="order('type')">Заявка<i class="fa" ng-show="predicate === 'type'" ng-class="{'fa-sort-asc':!reverse, 'fa-sort-desc':reverse}"></i><i class="fa fa-sort" ng-show="predicate != 'type'" ></i></a></th>
            <th nowrap><a href="" ng-click="order('details.comment')">Комментарий<i class="fa" ng-show="predicate === 'details.comment'" ng-class="{'fa-sort-asc':!reverse, 'fa-sort-desc':reverse}"></i><i class="fa fa-sort" ng-show="predicate != 'details.comment'" ></i></a></th>
            <th nowrap><a href="" ng-click="order('responds.length')">Кол-во откликов <i class="fa" ng-show="predicate === 'responds.length'" ng-class="{'fa-sort-asc':!reverse, 'fa-sort-desc':reverse}"></i><i class="fa fa-sort" ng-show="predicate != 'responds.length'" ></i></a></th>
            <th nowrap><a href="" ng-click="order('date')">Дата <i class="fa" ng-show="predicate === 'date'" ng-class="{'fa-sort-asc':!reverse, 'fa-sort-desc':reverse}"></i><i class="fa fa-sort" ng-show="predicate != 'date'" ></i></a></th>
            <th nowrap><a href="" ng-click="order('completed')">Статус <i class="fa" ng-show="predicate === 'completed'" ng-class="{'fa-sort-asc':!reverse, 'fa-sort-desc':reverse}"></i><i class="fa fa-sort" ng-show="predicate != 'date'" ></i></a></th>
        </tr>
        <tr ng-repeat="item in products | filter:query |orderBy:predicate:reverse" ng-click="viewItem(item)">
            <td><span class="sprite pull-left" ng-class="{'sprite-m1': item.type == 'Ногтевой сервис', 'sprite-m2': item.type == 'Парикмахерские услуги', 'sprite-m3': item.type == 'Косметология','sprite-m4': item.type == 'Визаж','sprite-m5': item.type == 'Массаж' ,'sprite-m6': item.type == 'Татуаж'}"></span><div class="table-name">{{item.name}}</div><div class="table-type">{{item.type}}</div></td>
            <td class="details">{{item.details.comment}}</td>
            <td class="text-center"><span class="numberofresponds">{{item.responds.length}}</span></td>
            <td class="date">{{formatDate(item.date)}}</td>
            <td class="respond-status"><span ng-if="item.completed" class="success-status">Завершена</span><span ng-if="!item.completed" class="viewed-status">Активна</span></td>
        </tr>
    </table>
    <h4 class="mobile-request text-center" ng-if="allitems">Заявки</h4>
    <div class="mobile-request" ng-repeat="item in products | orderBy:predicate:reverse" ng-if="allitems" ng-init="check_complete = false;" ng-click="viewItem(item)">
        <div class="clearfix" ng-click="viewItem(item)">
            <div class="pull-left">
            <div class="table-name">{{item.name}}</div>
            <div class="table-type">{{item.type}}</div>
            </div>
            <div class="amount-responds pull-right">
                <span><span class="numberofresponds">{{item.responds.length}}</span></span>
            </div>
        </div>
        <div class="clearfix pat10" ng-click="viewItem(item)" ng-show="item.details.comment">
            <div class="pull-left">
                <i class="sprite sprite-comment"></i><span>Комментарий</span>
            </div>
        </div>
        <div class="clearfix mobile-request__details" ng-click="viewItem(item)" ng-show="item.details.comment">
            {{item.details.comment  || 'Без комментариев'}}
        </div>
        <div class="clearfix date">
            {{formatDate(item.date)}}
        </div>
        <div class="clearfix active-buttons">
            <div class="pull-left">
                <button ng-click="viewItem(item)" class="btn" data-toggle="tooltip" title="Посмотреть">
                    <i class="sprite sprite-eye"></i>
                </button>
                <button ng-click="editItem(item)" ng-disabled="item.responds.length > 0" class="btn" data-toggle="tooltip" title="Изменить">
                    <i class="sprite sprite-edit"></i>
                </button>
                <button ng-click="isdeleteProduct(item)" class="btn" data-toggle="tooltip" title="Удалить">
                    <i class="sprite sprite-delete"></i>
                </button>
                <button ng-click="completeItem(item,item.type,item.auto,item.responds)" class="btn" data-toggle="tooltip" title="Завершить">
                    <i class="sprite sprite-play" ng-if="!item.completed"></i>
                    <i class="sprite sprite-stop" ng-if="item.completed"></i>
                </button>
            </div>
            <div class="pull-right">
                <span class="sprite pull-left" ng-class="{'sprite-m1': item.type == 'Ногтевой сервис', 'sprite-m2': item.type == 'Парикмахерские услуги', 'sprite-m3': item.type == 'Косметология','sprite-m4': item.type == 'Визаж','sprite-m5': item.type == 'Массаж' ,'sprite-m6': item.type == 'Татуаж'}"></span>
            </div>
        </div>
    </div>


    <table id="singleTable" class="table table-striped table-hover" ng-if="!allitems">
        <button ng-click="viewItem(null)" class="btn btn-xs btn-primary btn-icons btn-fixed" ng-if="!allitems">
            <i class="fa fa-arrow-left"></i>
        </button>
    <div class="table table-striped table-bordered table-hover" ng-if="!allitems">
    <div id="request{{$index+1}}"  ng-repeat="type in salon_types" ng-if="mainproduct.type == requests[$index]" ng-init="rootIndex = $index">
        <div class="panel panel-info panel-main">
          <div class="panel-heading">
            <h2 class="panel-title"><i class="sprite sprite-o{{$index+1}}"></i>{{mainproduct.type}}</h2>
          </div>
          <div class="panel-body">
                <form name="workForm{{$index+1}}" novalidate>
                      <div class="panel panel-info panel-sub" ng-show="startEdit || showsub(mainproduct.salons[rootIndex][parentIndex])" ng-repeat="subtype in type" ng-init="parentIndex = $index" ng-class="{'nosubtype':!subtype.title}">
                            <div class="panel-heading" role="tab" id="mend{{$index+1}}" ng-if="subtype.title">
                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" data-target="#colmend{{$index+1}}" aria-expanded="false" aria-controls="colmend{{$index+1}}">
                                <h4 class="panel-title">
                                  {{subtype.title}}<span class="strelka3"></span>
                                  </h4>
                                </a>
                              </h4>
                            </div>
                            <div id="colmend{{$index+1}}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="mend{{$index+1}}">
                              <div class="panel-body">
                                <div role="tabpanel" class="tab-pane active">
                                    <div class="form-group row">
                                        <ul class="checkbox-grid">
                                            <li ng-repeat="item in subtype.data">
                                                <label ng-hide="!startEdit && !mainproduct.salons[rootIndex][parentIndex][$index]"><input ng-disabled="!startEdit" type="checkbox" ng-model="mainproduct.salons[rootIndex][parentIndex][$index]" />
                                                {{item}}</label>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                </div>
                        </div>
                    </div>
                        <div class="form-group comment-form">
                            <p>Если вы не нашли интересующие вас услуги в списке выше, то вы можете описаь задачу своими словами. Для этого воспользуйтесь формой ниже. При необходимости вы можете прикрепить фотографии, которые помогут нашим партнерам сделать вам более точное предложение.</p>
                        </div>
                        <div class="form-group comment-area"><label><i class="sprite sprite-comment"></i>ЧТО НУЖНО СДЕЛАТЬ:</label><textarea ng-disabled="!startEdit" class="form-control" ng-model="mainproduct.details.comment" placeholder="Что нужно сделать?" rows="5"> </textarea></div>
                        <div class="clearfix b-first-block">
                            <div class="form-group pull-left" ng-class="{'has-error': errorfile}">
                                <div class="row photo-cube" ng-class="{'nomargin':mainproduct.details.image.length == 0}">
                                    <div class="col-md-3" ng-repeat="i in mainproduct.details.image">
                                        <a target="_blank" href="{{baseurl}}{{i}}"><img ng-dostyle="max-width:100%; border: 1px solid;" ng-src="{{baseurl}}{{i}}" /></a>
                                        <a class="pointer" ng-click="deleteImage(i);" ng-show="startEdit">удалить</a>
                                    </div>
                                </div>
                                <div class="sprite sprite-foto" ng-hide="!startEdit">
                                <input name="name" ng-hide="!startEdit" type='file' model='mainproduct.details.image' error='errorfile' ng-model='hello_file' file-feed multiple />
                                </div>
                                <div ng-show="errorfile">
                                    <span class="help-block" ng-show="errorfile == 'Toomuch'">Не более 4 файлов</span>
                                    <span class="help-block" ng-show="errorfile == 'Toomuch1mb'">Каждый файл не более 1 мб</span>
                                    <span class="help-block" ng-show="errorfile == 'Type'">Загружать можно только картинки</span>
                                </div>
                              
                            </div>
                            <div class="pull-right">  
                                <i class="sprite sprite-master-na-dom" ></i>    
                                <ul class="checkbox-grid">
                                <li>             
                                    <label><input ng-disabled="!startEdit" type="checkbox" ng-model="mainproduct.tohome" />
                                    Выезд на дом</label>
                                </li>
                                </ul>
                            </div>
                        </div>
                        <div class="clearfix b-second-block">
                            <div class="row pull-left">
                                <div class="col-md-12 pab20">
                                    <div class="btn-group">
                                        <label class="btn btn-default" ng-disabled="!startEdit" ng-hide="!mainproduct.manny" ng-model="mainproduct.manny" uib-btn-checkbox>
                                            <i class="sprite sprite-man h-sprite"></i><span>Мужской</span>
                                        </label>
                                        <label class="btn btn-default" ng-disabled="!startEdit" ng-hide="!mainproduct.girly" ng-model="mainproduct.girly" uib-btn-checkbox>
                                            <i class="sprite sprite-girl h-sprite-2"></i><span>Женский</span>
                                        </label>
                                        <label class="btn btn-default" ng-disabled="!startEdit" ng-hide="!mainproduct.childly" ng-model="mainproduct.childly" uib-btn-checkbox>
                                            <i class="sprite sprite-rebenok h-sprite-3"></i><span>Ребенок</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                <h4 class="header-time"><i class="sprite sprite-udobnoe-vremya"></i> Удобное время</h4>
                                </div>
                              <div class="col-md-6">
                              <p>с</p>
                                <p class="input-group">
                                
                                  <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-disabled="!startEdit" ng-click="open1()"><i class="sprite sprite-calendar"></i></button>
                                  </span>
                                  <input type="text" class="form-control" ng-disabled="!startEdit" uib-datepicker-popup ng-model="mainproduct.start" is-open="popup1.opened" datepicker-options="dateOptions" ng-required="true" close-text="Close" />
                                </p>
                              </div>

                              <div class="col-md-6">
                              <p>до</p>
                                <p class="input-group">
                                
                                  <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-disabled="!startEdit" ng-click="open2()"><i class="sprite sprite-calendar"></i></button>
                                  </span>
                                  <input type="text" class="form-control" ng-disabled="!startEdit" uib-datepicker-popup ng-model="mainproduct.end" is-open="popup2.opened" datepicker-options="dateOptions" ng-required="true" close-text="Close" />
                                </p>
                              </div>
                            </div>
                            <div class="form-group pull-right clearfix">
                                <i class="sprite sprite-udobnoe-vremya"></i>
                                <ul class="checkbox-grid">
                                    <li>             
                                        <label><input ng-disabled="!startEdit" type="checkbox" ng-model="mainproduct.time[0]" />
                                        Утренее время</label>
                                    </li>
                                    <li>             
                                        <label><input ng-disabled="!startEdit" type="checkbox" ng-model="mainproduct.time[1]" />
                                        Дневное время</label>
                                    </li>
                                    <li>             
                                        <label><input ng-disabled="!startEdit" type="checkbox" ng-model="mainproduct.time[2]" />
                                        Вечернее время</label>
                                    </li>
                                    <li>             
                                        <label><input ng-disabled="!startEdit" type="checkbox" ng-model="mainproduct.time[3]" />
                                        Ночное время</label>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    </div> 
<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true" ng-if="!allitems">
  <div class="panel panel-info panel-request" ng-hide="answered">
    <div class="panel-heading" role="tab" id="headingOne">
        <a role="button" data-toggle="collapse" data-parent="#accordion"  data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne" ng-disabled="mainproduct.completed">
        <h4 class="panel-title">
          Ответить на заявку<span class="strelka3"></span>
        </h4>
        </a>
    </div>
    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
        <div class="row bg-success text-center" style="padding:10px 0;" ng-if="mainproduct.completed">
                    Заявка завершена
        </div>
        <form name="priceform">
            <div class="form-group">
                <label>Цена</label>
                        <div class="input-group">
                        <input name="cost" class="form-control" ng-model="editedRespond.cost" ng-disabled="mainproduct.completed" ng-pattern="/^[0-9]{1,7}$/" ng-required="true"/>
                            <div class="input-group-addon">руб.</div>
                        </div>
            </div>
            <div class="form-group">
                <label>Комментарий</label>
                <textarea class="form-control" ng-model="editedRespond.description" placeholder="Подробно расскажите про детали предложения" rows="5" ng-disabled="mainproduct.completed"> </textarea>
            </div>
            <div class="form-group" ng-class="{'has-error': errorfile}" ng-init="editedRespond.images = [];">
                <div class="row photo-cube">
                    <div class="col-md-3" ng-repeat="i in editedRespond.images">
                        <a target="_blank" href="{{baseurl}}{{i}}"><img ng-dostyle="max-width:100%; border: 1px solid;" ng-src="{{baseurl}}{{i}}" /></a>
                        <a class="pointer" ng-click="deleteImage(editedRespond.images,i);">удалить</a>
                    </div>
                </div>
                <div class="sprite sprite-foto">
                    <input name="name" type='file' model='editedRespond.images' error='errorfile' ng-model='hello_file' file-feed multiple />
                </div>
                <div ng-show="errorfile">
                    <span class="help-block" ng-show="errorfile == 'Toomuch'">Не более 4 файлов</span>
                    <span class="help-block" ng-show="errorfile == 'Toomuch1mb'">Каждый файл не более 1 мб</span>
                    <span class="help-block" ng-show="errorfile == 'Type'">Загружать можно только картинки</span>
                </div>
            </div>
            <div class="text-center">
                <button type="submit" ng-click="createRespond(editedRespond);answered = true;"
                        ng-disabled="!editedRespond.cost || priceform.cost.$error.pattern || mainproduct.completed"
                        class="btn btn-primary" >
                    Добавить
                </button>
            </div>
        </form>
      </div>
    </div>
  </div>
  <div class="container-fluid">
      <div class="panel panel-success" ng-if="!allitems && !startEdit && activeresponds.length > 0">
            <div class="panel-heading" role="tab" id="headingTwo">
                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    <h4 class="panel-title">
                  <i class="sprite sprite-otv-na-zayavku"></i>Ответы на заявку<span class="answers">Ответов: {{activeresponds.length}}</span>
                  </h4>
                </a>
            </div>
    <div id="collapseTwo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingTwo">
        <div class="container-fluid mobile-request-hide">
            <div class="row row-title">
                <div class="col-md-4">
                    Название компании
                </div>
                <div class="col-md-2">
                    Комментарий
                </div>
                <div class="col-md-2">
                    Стоимость
                </div>
                <div class="col-md-2">
                    Дата заявки
                </div>
                <div class="col-md-2">
                </div>
            </div>
            <div class="row row-hover" ng-repeat="item in activeresponds" ng-class="{'bg-success': item.approved}">
                <div class="col-md-4" ng-click="toogleAutoservice[$index] = !toogleAutoservice[$index];">
                    <div class="autoservice__view"><span class="sprite sprite-metka"></span></div>
                    <div class="autoservice__name"><a target="_blank" title="{{item.autoservice.name}}" href="{{item.autoservice.link}}">{{item.autoservice.name}}</a></div>
                    <div class="autoservice__metro"><span class="metro"></span>{{item.autoservice.metro}}</div>
                </div>
                <div class="col-md-2" ng-click="toogleAutoservice[$index] = !toogleAutoservice[$index];">
                    <span class="sprite sprite-comment"></span>
                    Прочесть
                </div>
                <div class="col-md-3" ng-click="toogleAutoservice[$index] = !toogleAutoservice[$index];">
                    <span ng-if="item.autoserviceid == autoservice.id">{{item.cost | currency}}</span><span class="respond-status" ng-if="item.autoserviceid != autoservice.id"><span style="color: #BD0101; border: 1px solid;">Скрыто</span></span>
                </div>
                <div class="col-md-3 date" ng-click="toogleAutoservice[$index] = !toogleAutoservice[$index];">
                    {{formatDate(item.date)}}
                </div>
                <div class="col-lg-12" ng-show="toogleAutoservice[$index]">
                    <span ng-if="item.autoserviceid == autoservice.id">{{item.description}}</span><span class="respond-status" ng-if="item.autoserviceid != autoservice.id"><span style="color: #BD0101; border: 1px solid;">Скрыто</span></span>
                    <div class="row">
                        <div class="col-sm-3" ng-if="item.autoserviceid == autoservice.id" ng-repeat="i in item.images">
                            <a target="_blank" href="{{baseurl}}{{i}}"><img ng-dostyle="max-width:200px; border: 1px solid;" ng-src="{{baseurl}}{{i}}" /></a>
                        </div>
                    </div>
                </div>
            </div> 
        </div>
        <div class="mobile-request" ng-repeat="item in activeresponds">
            <div class="clearfix">
                <div class="pull-left">
                    <div class="autoservice__view"><span class="sprite sprite-metka"></span></div>
                    <div class="autoservice__name"><a target="_blank" title="{{item.autoservice.name}}" href="{{item.autoservice.link}}">{{item.autoservice.name}}</a></div>
                    <div class="autoservice__metro"><span class="metro"></span>{{item.autoservice.metro}}</div>
                </div>
                <div class="pull-right">
                    <span class="mobile-request__name">{{item.cost | currency}}</span>
                </div>
            </div>
            <div class="clearfix">
                <div class="pull-left">
                    Комментарий
                </div>
                <div class="pull-right">
                    
                </div>
            </div>
            <div class="clearfix mobile-request__details">
                {{item.description || 'Без комментариев'}}
            </div>
            <div class="clearfix">
                <div class="pull-left toogle-action" >
                    <button ng-class="{'btn-success': (!item.approved),'btn-danger': (item.approved)}" ng-click="approveRespond(item,item.autoservice)" class="btn btn-xs">
                                <span ng-if="!item.approved">Принять</span>
                                <span ng-if="item.approved">Отклонить</span>
                    </button>
                </div>
                <div class="pull-right date">
                    {{formatDate(item.date)}}
                </div>
            </div>
        </div>
    </div>
        </div>
    </div>
</div>
</div>
